{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dashboard",
  "abandonmentThreshold": "10 years",
  "assigneesFromCodeOwners": true,
  "reviewersFromCodeOwners": true,
  "suppressNotifications": [
    "prIgnoreNotification"
  ],
  "prConcurrentLimit": 10,
  "helmv3": {
    "managerFilePatterns": [
      "charts/stable/**/Chart.yaml"
    ]
  },
  "helm-values": {
    "managerFilePatterns": [
      "charts/stable/**/Chart.yaml"
    ]
  },
  "ignorePaths": [
    "unmaintained/"
  ],
  "hostRules": [
    {
      "matchHost": "api.github.com",
      "concurrentRequestLimit": 1
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "datasourceTemplate": "docker",
      "managerFilePatterns": [
        "charts/stable/**/Chart.yaml"
      ],
      "matchStrings": [
        "#\\s*renovate: image=(?<depName>.*?)\\s+appVersion:\\s*[\"']?(?<currentValue>[\\w+\\.\\-]*)"
      ]
    }
  ],
  "packageRules": [
    {
      "matchDatasources": [
        "docker"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "commitMessageTopic": "Update Docker image {{depName}}",
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "helm"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "commitMessageTopic": "Update Helm chart {{depName}}",
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchManagers": [
        "custom.regex"
      ],
      "matchFileNames": [
        "charts/stable/**/Chart.yaml"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "github-tags"
      ],
      "matchPackageNames": [
        "potiuk/get-workflow-origin"
      ],
      "versioning": "regex:^v(?<major>\\d+)_(?<minor>\\d+)(_(?<patch>\\d+))?$"
    },
    {
      "matchManagers": [
        "github-actions"
      ],
      "automerge": true,
      "automergeType": "branch",
      "matchUpdateTypes": [
        "minor",
        "patch"
      ]
    },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "commitMessagePrefix": "[{{{parentDir}}}]",
    //   "branchTopic": "{{{parentDir}}}-{{{depNameSanitized}}}-{{{newMajor}}}{{#if isPatch}}.{{{newMinor}}}{{/if}}.x{{#if isLockfileUpdate}}-lockfile{{/if}}",
    //   "matchUpdateTypes": [
    //     "major"
    //   ],
    //   "bumpVersion": "major",
    //   "labels": [
    //     "type/major"
    //   ],
    //   "matchPackageNames": [
    //     "common"
    //   ],
    //   "groupName": "common library major"
    // },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "matchUpdateTypes": [
    //     "minor"
    //   ],
    //   "bumpVersion": "minor",
    //   "labels": [
    //     "type/minor"
    //   ],
    //   "matchPackageNames": [
    //     "common"
    //   ],
    //   "groupName": "common library minor"
    // },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "matchUpdateTypes": [
    //     "patch"
    //   ],
    //   "bumpVersion": "patch",
    //   "labels": [
    //     "type/patch"
    //   ],
    //   "matchPackageNames": [
    //     "common"
    //   ],
    //   "groupName": "common library patch"
    // },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "commitMessagePrefix": "[{{{parentDir}}}]",
    //   "branchTopic": "{{{parentDir}}}-{{{depNameSanitized}}}-{{{newMajor}}}{{#if isPatch}}.{{{newMinor}}}{{/if}}.x{{#if isLockfileUpdate}}-lockfile{{/if}}",
    //   "matchUpdateTypes": [
    //     "major"
    //   ],
    //   "bumpVersion": "major",
    //   "labels": [
    //     "type/major"
    //   ],
    //   "schedule": [
    //     "every 3 months on the first day of the month"
    //   ],
    //   "matchPackageNames": [
    //     "!common"
    //   ]
    // },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "matchUpdateTypes": [
    //     "minor"
    //   ],
    //   "bumpVersion": "minor",
    //   "labels": [
    //     "type/minor"
    //   ],
    //   "groupName": "external dependency minor",
    //   "schedule": [
    //     "every 2 months on the first day of the month"
    //   ],
    //   "matchPackageNames": [
    //     "!common"
    //   ]
    // },
    // {
    //   "matchDatasources": [
    //     "helm"
    //   ],
    //   "matchUpdateTypes": [
    //     "patch"
    //   ],
    //   "bumpVersion": "patch",
    //   "labels": [
    //     "type/patch"
    //   ],
    //   "groupName": "external dependency patch",
    //   "schedule": [
    //     "every 1 months on the first day of the month"
    //   ],
    //   "matchPackageNames": [
    //     "!common"
    //   ]
    // }
  ]
}
