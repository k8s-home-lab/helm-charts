{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dashboard",
  "abandonmentThreshold": "10 years",
  "assigneesFromCodeOwners": true,
  "reviewersFromCodeOwners": true,
  "suppressNotifications": [
    "prIgnoreNotification"
  ],
  "prConcurrentLimit": 10,
  "helmv3": {
    "managerFilePatterns": [
      "charts/stable/**/Chart.yaml"
    ]
  },
  "helm-values": {
    "managerFilePatterns": [
      "charts/stable/**/Chart.yaml"
    ]
  },
  "ignorePaths": [
    "unmaintained/"
  ],
  "hostRules": [
    {
      "matchHost": "api.github.com",
      "concurrentRequestLimit": 1
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "datasourceTemplate": "docker",
      "managerFilePatterns": [
        "charts/stable/**/Chart.yaml"
      ],
      "matchStrings": [
        "#\\s*renovate: image=(?<depName>.*?)\\s+appVersion:\\s*[\"']?(?<currentValue>[\\w+\\.\\-]*)"
      ]
    }
  ],
  "packageRules": [
    {
      "matchManagers": [
        "custom.regex"
      ],
      "matchFileNames": [
        "charts/stable/**/Chart.yaml"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "commitMessageTopic": "Update Docker image {{depName}}",
      "matchUpdateTypes": [
        "major",
        "minor"
      ],
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "commitMessageTopic": "Update Docker image {{depName}}",
      "matchUpdateTypes": [
        "patch"
      ],
      "schedule": [
        "every 1 months on the first day of the month"
      ],
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "helm"
      ],
      "commitMessagePrefix": "[{{{parentDir}}}]",
      "commitMessageTopic": "Update Helm chart {{depName}}",
      "matchPackageNames": [
        "!common"
      ],
      // "schedule": [
      //   "every 1 months on the first day of the month"
      // ],
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "helm"
      ],
      "commitMessageTopic": "Update Helm common library chart",
      "matchPackageNames": [
        "common"
      ],
      "groupName": "common library update",
      "postUpgradeTasks": {
        "commands": [
          "bash .github/scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{updateType}}}' {{{depName}}} '{{{newVersion}}}'"
        ]
      }
    },
    {
      "matchDatasources": [
        "github-tags"
      ],
      "matchPackageNames": [
        "potiuk/get-workflow-origin"
      ],
      "versioning": "regex:^v(?<major>\\d+)_(?<minor>\\d+)(_(?<patch>\\d+))?$"
    },
    {
      "matchManagers": [
        "github-actions"
      ],
      "automerge": true,
      "automergeType": "branch",
      "matchUpdateTypes": [
        "minor",
        "patch"
      ]
    }
  ]
}
